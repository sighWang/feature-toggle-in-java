{"name":"Feature-toggle-in-java","tagline":"","body":"# Feature Toggle in Java\r\nIn our project, we choose [togglz](http://www.togglz.org/) as a framework for feature toggle.\r\n## import togglz in project\r\nWe need to add these dependencies in project file `build.gradle`\r\n```shell\r\n  compile 'org.togglz:togglz-core:2.2.0.Final'\r\n  compile 'org.togglz:togglz-servlet:2.2.0.Final'\r\n  compile 'org.togglz:togglz-jsp:2.2.0.Final' //support jsp\r\n  compile 'org.togglz:togglz-console:2.2.0.Final'  //support togglz console\r\n  compile 'org.togglz:togglz-spring-security:2.2.0.Final' //support user authentication\r\n\r\n  testCompile 'org.togglz:togglz-testing:2.2.0.Final' //support togglz test\r\n  testCompile 'org.togglz:togglz-junit:2.2.0.Final' //support togglz test\r\n```\r\n## config togglz in project\r\n### Add a new class `ToggledFeature` `implements Feature`\r\n```java\r\npublic enum ToggledFeature implements Feature {\r\n    @Label(\"CONFIRM_PASSWORD\")\r\n    CONFIRM_PASSWORD,\r\n\r\n    @Label(\"ADDRESS\")\r\n    ADDRESS,\r\n\r\n    @Label(\"AGREE_TERMS\")\r\n    AGREE_TERMS,\r\n\r\n    @Label(\"EMAIL_CONFIRMATION\")\r\n    EMAIL_CONFIRMATION;\r\n\r\n    public boolean isActive() {\r\n        return FeatureContext.getFeatureManager().isActive(this);\r\n    }\r\n}\r\n```\r\n### Add a new class `ToggledFeatureConfiguration`  `implements TogglzConfig`\r\n```java\r\npublic class ToggledFeatureConfiguration implements TogglzConfig{\r\n    public Class<? extends Feature> getFeatureClass() {\r\n        return ToggledFeature.class;\r\n    }\r\n\r\n    public StateRepository getStateRepository() {\r\n        ClassLoader classLoader = getClass().getClassLoader();\r\n        File file = new File(classLoader.getResource(\"features.properties\").getFile());\r\n        return new FileBasedStateRepository(file);\r\n    }\r\n\r\n    @Override\r\n    public UserProvider getUserProvider() {\r\n        return new SpringSecurityUserProvider(\"ROLE_ADMIN\") {\r\n        };\r\n    }\r\n\r\n}\r\n```\r\n### Add a `features.peoperties` file to set togglz status\r\n```shell\r\nCONFIRM_PASSWORD=true\r\nADDRESS=true\r\nAGREE_TERMS=true\r\nEMAIL_CONFIRMATION=true\r\n```\r\n### Then config togglz in `web.xml`\r\n```xml\r\n<context-param>\r\n       <param-name>org.togglz.core.manager.TogglzConfig</param-name>\r\n       <param-value>com.trailblazers.freewheelers.utils.ToggledFeature.ToggledFeatureConfiguration</param-value>\r\n   </context-param>\r\n\r\n   <filter>\r\n       <filter-name>TogglzFilter</filter-name>\r\n       <filter-class>org.togglz.servlet.TogglzFilter</filter-class>\r\n   </filter>\r\n   <filter-mapping>\r\n       <filter-name>TogglzFilter</filter-name>\r\n       <url-pattern>/*</url-pattern>\r\n   </filter-mapping>\r\n```\r\n### Now we can use <togglz:feature> in JSP file\r\n* First, we need to add togglz tags to jsp file\r\n```html\r\n<%@ taglib prefix=\"togglz\" uri=\"http://togglz.org/taglib\"%>\r\n```\r\n\r\n* Then we can use togglz to hide elements\r\n```html\r\n    <togglz:feature name=\"AGREE_TERMS\">\r\n        <div>\r\n\r\n        </div>\r\n    </togglz:feature>\r\n```\r\n\r\n## How to use ToggledFeatures in Unit Test\r\n```java\r\npublic class ToggledFeaturesTest {\r\n\r\n    @Rule\r\n    public TogglzRule togglzRule = TogglzRule.allEnabled(ToggledFeature.class);\r\n\r\n    @Test\r\n    public void testToggleFeature() {\r\n\r\n        assertTrue(ToggledFeature.CONFIRM_PASSWORD.isActive());\r\n\r\n        togglzRule.disable(ToggledFeature.CONFIRM_PASSWORD);\r\n        assertFalse(ToggledFeature.CONFIRM_PASSWORD.isActive());\r\n    }\r\n\r\n    @After\r\n    public void tearDown() throws Exception {\r\n        togglzRule.disableAll();\r\n    }\r\n}\r\n```\r\n\r\n## How to show toggle console in browser\r\n* First, we need to add toggle servlet in `web.xml`\r\n```xml\r\n    <servlet>\r\n        <servlet-name>TogglzConsoleServlet</servlet-name>\r\n        <servlet-class>org.togglz.console.TogglzConsoleServlet</servlet-class>\r\n    </servlet>\r\n    <servlet-mapping>\r\n        <servlet-name>TogglzConsoleServlet</servlet-name>\r\n        <url-pattern>/togglz/*</url-pattern>\r\n    </servlet-mapping>\r\n```\r\n* Then login with admin role and open http://localhost:8080/togglz/\r\n* Now we can use this page to toggle feature\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}